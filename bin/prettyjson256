#!/usr/bin/env node

const prettyjson = require('../index.babel');
const fs = require('fs');
const argv = require('minimist')(process.argv.slice(2));

let options = prettyjson._defaultOptions;

let renderInputJson = (input) => {
  console.log(prettyjson.renderString(input, options));
};

if (argv._.length) {
  // First parameter is the file to read and parse
  var filename = argv._[0];
  try {
    renderInputJson(fs.readFileSync(filename, 'utf8'));
  } catch (e) {
    console.error('Error reading: ' + filename );
    console.error(e);
    console.error(e.stack);
    process.exit(1);
  }
} else {
  // Read input stream

  var streamData = '';

  process.stdin.resume();
  process.stdin.setEncoding('utf8');
  process.stdin.on('data', (chunk) => {
    if (chunk === '\n') {
      renderInputJson(streamData);
      streamData = '';
      return;
    } else if (/\n$/.test(chunk)) {
      streamData += chunk;
      streamData.split('\n').forEach(renderInputJson);
      streamData = '';
      return;
    }
    streamData += chunk;
  });
  process.stdin.on('end', function(){
    renderInputJson(streamData);
  });
}
